<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <style type="text/css">
        p.count{display: block;}
        div.opening{background-color:#fff;width:50px;height:50px;border-radius:50%;margin:0 auto;border:5px solid #000;position:relative}
        div.opening div.circle{background-color:#000;width:50px;height:50px;margin-left:-25px;margin-top:-25px;border-radius:50%;position:absolute;top:50%;left:50%;transition-property: transform,background-color;transition-duration: 1s;transition-timing-function: ease-out;transform: scale(0.3);transition-style: preserve-3d;-webkit-transition-property: -webkit-transform,background-color;-webkit-transition-duration:1s;-webkit-transition-timing-function:ease-out;-webkit-transform: scale(0.3);-webkit-transform-style: preserve-3d;-moz-transition-property: -moz-transform,color;-moz-transition-duration:1s;-moz-transition-timing-function:ease-out;-moz-transform: scale(0.3);-moz-transform-style: preserve-3d;backface-visibility: visible;-webkit-backface-visibility: visible;-moz-backface-visibility: visible;}
        figure{display:block;position:relative;margin:0 auto;left:auto;top:auto;margin-top:20px;}
        figure.kudo{#position: absolute;margin-left: 90%;right: 50%;margin-right: -30px;margin-bottom: 5px;top: 3px;text-align:center;}
        /*figure.kudo article a.kudobject p{text-align:center;display:block;margin:0;padding:0;line-height:50px;width:auto;height:auto}*/
        .kudo.complete a.kudobject div.opening div.circle{
        background-image: url("data:image/png;base64,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");
        background-position: center;background-repeat: no-repeat;background-color: #000;background-size:80%;-moz-background-size:80%;}
        a.count {text-decoration: none;}
        a.count span {width:auto;text-transform:uppercase;font-family:"freight-sans-pro",sans-serif;margin-top:5px;color:#000;font-weight:800;display:block;line-height: 13px;margin-top:5px;}
        a.count span.num {font-size: 18px;}
        a.count span.txt {font-size: 11px;}
        a.count p span.dont-move{font-size:18px;text-transform:none;line-height:22px;width:200px;margin-left:-50px;margin-top:8px;letter-spacing:0;}
        a.kudobject{display: block;cursor: pointer;}
        a.kudobject :hover { text-decoration: none ! important; }
        .kudo.active a.kudobject div.opening div.circle{transform: scale(1.1);-webkit-transform: scale(1.1);-moz-transform: scale(1.1);background:rgba(0,0,0,0.7)}
        .kudo.complete a.kudobject div.opening div.circle{transition-property: none;animation: bounce 1s;animation-iteration-count: 1;transform: scale(0.85); -webkit-transition-property: none;-webkit-animation: bounce 1s;-webkit-animation-iteration-count: 1;-webkit-transform: scale(0.85);-moz-transition-property: none;-moz-animation: bounce 1s;-moz-animation-iteration-count: 1;-moz-transform: scale(0.85);}
        @keyframes bounce { 
          0% {transform: scale(1.1);background-color: #000;opacity: 1;}
          50% {transform: scale(1.6);opacity: .7;background-color: #000;}
          60% {transform: scale(0.6);opacity: 1;}
          80% { transform: scale(0.95) }
          100% { transform: scale(0.85) }}
        @-webkit-keyframes bounce { 
          0% {-webkit-transform: scale(1.1);background-color: #000;opacity: 1;}
          50% {-webkit-transform: scale(1.6);opacity: .7;background-color: #000;}
          60% {-webkit-transform: scale(0.6);opacity: 1;}
          80% { -webkit-transform: scale(0.95) }
          100% { -webkit-transform: scale(0.85) }}
        @-moz-keyframes bounce { 
          0% {-moz-transform: scale(1.1);background-color: #000;opacity: 1;}
          50% {-moz-transform: scale(1.6);opacity: .7;background-color: #000;}
          60% {-moz-transform: scale(0.6);opacity: 1;}
          80% { -moz-transform: scale(0.95) }
          100% { -moz-transform: scale(0.85) }}
    </style>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.firebase.com/js/client/2.2.5/firebase.js"></script>
    <script type="text/javascript">
        (function (exports, undefined) {

            // replace this url with yours!!
            var firebase = new Firebase('https://firekudos.firebaseio.com/'),
                firebaseKudos = firebase.child('kudos'),
                key = document.location.pathname.replace(/[\/-]/g, '');

            var getAuthData = function () {
                var deferred = $.Deferred();

                var authData = firebase.getAuth();
                if (authData == null) {
                    // authenticate the user
                    firebase.authAnonymously(function (err, authenticationData) {
                        //authData = authenticationData
                        deferred.resolve(authenticationData);
                    });
                } else {
                    deferred.resolve(authData);
                }

                return deferred.promise();
            };

            // fix for local debugging
            if (key === '') {
                key = 'localhost'
            }

            var hasVoted = function () {
                var deferred = $.Deferred();

                getAuthData().then(function (authData) {
                    firebaseKudos.child(key).child('likes').child(authData.uid).once('value', function (snap) {
                        deferred.resolve(snap.val() !== null);
                    });
                });
                return deferred.promise();
            };


            var addKudo = function () {
                getAuthData().then(function (authData) {
                    firebaseKudos
                        .child(key)
                        .child('likes')
                        .child(authData.uid)
                        .set({
                            count: 1
                        });
                });
            };

            var removeKudo = function () {
                getAuthData().then(function (authData) {
                    firebaseKudos
                        .child(key)
                        .child('likes')
                        .child(authData.uid)
                        .remove();
                });
            };

            // listening for updates

            var onKudoUpdates = function (cb) {
                firebaseKudos.child(key).on('value', function (snapshot) {
                    if (snapshot) {
                        var article = snapshot.val();
                        var likeCount = 0;
                        if (article) {
                            for (var prop in article.likes) {
                                likeCount++;
                            }
                        }
                        cb(likeCount);
                    }
                });
            }

            var firebaseStorage = {
                hasVoted: hasVoted,
                addKudo: addKudo,
                removeKudo: removeKudo,
                onKudoUpdates: onKudoUpdates
            };

            exports.firebaseStorage = firebaseStorage;

// ------------------------
            var firebaseEpu = new Firebase('https://td-epu.firebaseio.com/'),
                firebaseEpuForms = firebase.child('epuForms');

            var getAuthDataEpu = function () {
                var deferred = $.Deferred();
                var authData = firebaseEpu.getAuth();
                if (authData == null) {
                    // authenticate the user
                    firebaseEpu.authAnonymously(function (err, authenticationData) {
                        //authData = authenticationData
                        deferred.resolve(authenticationData);
                    });
                } else {
                    deferred.resolve(authData);
                }
                return deferred.promise();
            };

            var getForm = function (id) {
                var deferred = $.Deferred();
                getAuthDataEpu().then(function (authData) {
                    firebaseEpuForms.child(id).once('value',
                     function (snap) {
                         deferred.resolve(snap.val() !== null);
                     });
                });
                return deferred.promise();
            };

            var firebaseStorageEpu = {
                getForm: getForm
            };

            exports.firebaseStorageEpu = firebaseStorageEpu;

// ------------------------

        })(window);
    </script>
    <script>
        (function ($, undefined) {

            var Kudoable,
                __bind = function (fn, me) { return function () { return fn.apply(me, arguments); }; };

            Kudoable = (function () {
                var key = document.location.pathname;

                function Kudoable(element, options) {
                    var self = this;

                    this.element = element;
                    this.dataStore = options.dataStore;

                    this.start = __bind(this.start, this);
                    this.stop = __bind(this.stop, this);
                    this.complete = __bind(this.complete, this);
                    this.undo = __bind(this.undo, this);

                    // hook on the mouse and touch events
                    $(document).on('touchstart', this.element, this.start);
                    $(document).on('touchend', this.element, this.stop);
                    this.element.mouseenter(this.start);
                    this.element.mouseleave(this.stop);
                    this.element.click(this.undo);

                    // init
                    this.render();
                    this.$counter = this.element.find('.count .num');

                    this.dataStore.hasVoted()
                        .then(function (hasVoted) {
                            if (hasVoted) {
                                // set to complete
                                self.element.addClass('complete');
                            }
                        });

                    this.dataStore.onKudoUpdates(function (kudoCount) {
                        self.setCount(kudoCount);
                    });
                }

                Kudoable.prototype.render = function () {
                    var template = $('<a class="kudobject">' +
                                            '<div class="opening">' +
                                                '<div class="circle">&nbsp;</div>' +
                                            '</div>' +
                                        '</a>' +
                                        '<a href="#kudo" class="count">' +
                                            '<span class="num">0</span>' +
                                            '<span class="txt">Kudos</span>' +
                                        '</a>');
                    this.element.append(template);
                };

                Kudoable.prototype.start = function () {
                    if (!this.isKudoed()) {
                        this.element.addClass('active');

                        this.activationTimer = setTimeout(this.complete, 700);
                    }
                };

                Kudoable.prototype.stop = function () {
                    clearTimeout(this.activationTimer);

                    this.element.removeClass('active');
                };

                Kudoable.prototype.complete = function () {
                    this.stop();

                    // this.incrementCount();
                    this.dataStore.addKudo();
                    // this.element.trigger('kudo.added', { count: this.currentCount() });

                    this.element.addClass('complete');
                };

                Kudoable.prototype.undo = function () {
                    if (this.isKudoed()) {
                        // if(this.currentCount() > 0){
                        //     this.decrementCount();
                        // }

                        this.dataStore.removeKudo();
                        // this.element.trigger('kudo.removed', { count: this.currentCount() });

                        this.element.removeClass('complete');
                    }
                };

                Kudoable.prototype.currentCount = function () {
                    var count = parseInt(this.$counter.html(), 10);
                    if (isNaN(count))
                        count = 0;

                    return count;
                };

                Kudoable.prototype.isKudoed = function () {
                    return this.element.hasClass('complete');
                };

                Kudoable.prototype.setCount = function (count) {
                    this.$counter.html(count);
                };

                return Kudoable;

            })();

            $(function () {
                $.fn.kudoable = function (options) {
                    return this.each(function () {
                        return new Kudoable($(this), options);
                    });
                };
            })

        })(jQuery);
    </script>    
    <script>
        $(function () {
alert("aqui1...");
var kk = 50;
alert(window.firebaseStorageEpu.getForm('frmLogin').then(function (getForm) { console.log('aqui... la leche') }));
alert("aqui2...");
            //$('figure').kudoable({
            //    dataStore: window.firebaseStorage
            //});
alert("aqui3...");
            alert(window.firebaseStorageEpu.getForm('frmLogin'));
        });


    </script>
</head>
<body>
    <h1>Firebase Kudos</h1>
    <hr />
    <figure class="kudo"></figure>
</body>
</html>
